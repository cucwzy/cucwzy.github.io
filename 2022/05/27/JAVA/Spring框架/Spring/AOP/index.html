<!DOCTYPE html>

<html lang="en">

<head>
    
    <title>AOP面向切面编程 - Shuyan</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <meta name="description" content="AOP，Aspect Oriented Programming的缩写，意为面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。 为什么要使用AOP？   程序的最终目的就是实现业务，但是我们在进行编程的过程中经常会发现除了所谓的业务代码，还存在数量相当的公共代码，类似日志、安全验证、事物、异常处理等问题。这部分代码重要但是与我们编写程序要实现的功能没有关系，具有功能相似、">
<meta property="og:type" content="article">
<meta property="og:title" content="AOP面向切面编程">
<meta property="og:url" content="http://example.com/2022/05/27/JAVA/Spring%E6%A1%86%E6%9E%B6/Spring/AOP/index.html">
<meta property="og:site_name" content="Shuyan">
<meta property="og:description" content="AOP，Aspect Oriented Programming的缩写，意为面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。 为什么要使用AOP？   程序的最终目的就是实现业务，但是我们在进行编程的过程中经常会发现除了所谓的业务代码，还存在数量相当的公共代码，类似日志、安全验证、事物、异常处理等问题。这部分代码重要但是与我们编写程序要实现的功能没有关系，具有功能相似、">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-05-27T03:29:01.000Z">
<meta property="article:modified_time" content="2022-05-27T14:10:51.519Z">
<meta property="article:author" content="Shuyan">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
    <link rel="stylesheet" href="/lib/jquery.fancybox.min.css?v=1657720477504">
    
        <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
    
    <link rel="stylesheet" href="/lib/mdui_043tiny/css/mdui.css?v=1657720477504">
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1657720477504">
    <link rel="stylesheet" href="/css/style.css?v=1657720477504">
     
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(http://mms0.baidu.com/it/u=2467909075,3604847220&amp;fm=253&amp;app=138&amp;f=JPEG&amp;fmt=auto&amp;q=75?w=801&amp;h=500)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="Shuyan" class="mdui-btn mdui-btn-icon"><img src="http://mms2.baidu.com/it/u=1730774443,2723245118&amp;fm=253&amp;app=120&amp;f=JPEG&amp;fmt=auto&amp;q=75?w=500&amp;h=500" alt="Shuyan"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Shuyan">
            <img src="http://mms2.baidu.com/it/u=1730774443,2723245118&amp;fm=253&amp;app=120&amp;f=JPEG&amp;fmt=auto&amp;q=75?w=500&amp;h=500" alt="Shuyan" alt="Shuyan">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>Articles</span>100</div>
        <div><span>Tags</span>20</div>
        <div><span>Categories</span>34</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/categories" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about" title="梦华录">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                梦华录
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://cn.bing.com/search?q=site:nexmoe.com" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="Search"></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://qm.qq.com/cgi-bin/qm/qr?k=rd1wdMWxpIZJe5AIruJkY7xD8d68h031&noverify=0" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/400417888" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/nexmoe/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/C语言/">C语言</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Docker/">Docker</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/">JAVA</a>
          <span class="category-list-count">43</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Spring框架”/JavaWeb/">JavaWeb</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/LaTex/">LaTex</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/">Leetcode</a>
          <span class="category-list-count">21</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Linux/">Linux</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Spring框架”/Mybaits/">Mybaits</a>
          <span class="category-list-count">6</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Spring框架”/SSM/">SSM</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/C语言/STL/">STL</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Spring框架”/Spring/">Spring</a>
          <span class="category-list-count">7</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Spring框架”/SpringBoot/">SpringBoot</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Spring框架”/SpringMVC/">SpringMVC</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/Spring框架/">Spring框架</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/sort/">sort</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Docker”/">“Docker”</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“JAVA基础知识”/">“JAVA基础知识”</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“JVM”/">“JVM”</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Nginx”/">“Nginx”</a>
          <span class="category-list-count">8</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Redis”/">“Redis”</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/Spring框架/“Security”/">“Security”</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/“Spring框架”/">“Spring框架”</a>
          <span class="category-list-count">22</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/二叉树/">二叉树</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/剑指offer/">剑指offer</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/动态规划/">动态规划</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/线性表/单链表/">单链表</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/字符串/">字符串</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/线性表/数组/">数组</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/栈和队列/">栈和队列</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/算法/">算法</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/线性表/">线性表</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JAVA/网络编程/">网络编程</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/联邦学习/">联邦学习</a>
          <span class="category-list-count">11</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Leetcode/贪心算法/">贪心算法</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Tag Cloud</h3>
    <div id="randomtagcloud" class="nexmoe-widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 12.5px;">Docker</a> <a href="/tags/JAVA/" style="font-size: 12.5px;">JAVA</a> <a href="/tags/JVM/" style="font-size: 12.5px;">JVM</a> <a href="/tags/JavaWeb/" style="font-size: 12.5px;">JavaWeb</a> <a href="/tags/LaTex/" style="font-size: 10px;">LaTex</a> <a href="/tags/Leetcode/" style="font-size: 20px;">Leetcode</a> <a href="/tags/Linux/" style="font-size: 11.25px;">Linux</a> <a href="/tags/Mybaits/" style="font-size: 15px;">Mybaits</a> <a href="/tags/Nginx/" style="font-size: 17.5px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 12.5px;">Redis</a> <a href="/tags/SSM/" style="font-size: 10px;">SSM</a> <a href="/tags/STL/" style="font-size: 12.5px;">STL</a> <a href="/tags/Security/" style="font-size: 11.25px;">Security</a> <a href="/tags/Spring/" style="font-size: 16.25px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 12.5px;">SpringBoot</a> <a href="/tags/SpringMVC/" style="font-size: 11.25px;">SpringMVC</a> <a href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/" style="font-size: 13.75px;">二叉树</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 11.25px;">动态规划</a> <a href="/tags/%E6%90%9C%E7%B4%A2/" style="font-size: 11.25px;">搜索</a> <a href="/tags/%E8%81%94%E9%82%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 18.75px;">联邦学习</a>
    </div>
    
  </div>
  <style>
    #nexmoe-header .nexmoe-widget-wrap .tagcloud a:nth-child(7n+1) {
    background-color: rgba(255,78,106,0.15);
    color: rgba(255,78,106,0.8);
    }
    #nexmoe-header .nexmoe-widget-wrap .tagcloud a:nth-child(7n+2) {
    background-color: rgba(255,170,115,0.15);
    color: #ffaa73;
    }
    #nexmoe-header .nexmoe-widget-wrap .tagcloud a:nth-child(7n+3) {
    background-color: rgba(254,212,102,0.15);
    color: #fed466;
    }
    #nexmoe-header .nexmoe-widget-wrap .tagcloud a:nth-child(7n+4) {
    background-color: rgba(60,220,130,0.15);
    color: #3cdc82;
    }
    #nexmoe-header .nexmoe-widget-wrap .tagcloud a:nth-child(7n+5) {
    background-color: rgba(100,220,240,0.15);
    color: #64dcf0;
    }
    #nexmoe-header .nexmoe-widget-wrap .tagcloud a:nth-child(7n+6) {
    background-color: rgba(100,185,255,0.15);
    color: #64b9ff;
    }
    #nexmoe-header .nexmoe-widget-wrap .tagcloud a:nth-child(7n+7) {
    background-color: rgba(180,180,255,0.15);
    color: #b4b4ff;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta {
    margin: 25px 0px;
    font-size: 0;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a {
    border-radius: 20px;
    padding: 10px 18px;
    color: #fff;
    font-size: 14px;
    display: inline-block;
    margin-bottom: 5px;
    margin-right: 10px;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a .nexmoefont {
    font-size: 14px;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:before,
    #nexmoe-content .nexmoe-post .nexmoe-post-meta i:before {
    margin-right: 5px;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:nth-child(7n+1) {
    background-color: rgba(255,78,106,0.15);
    color: #ff4e6a;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:nth-child(7n+2) {
    background-color: rgba(255,170,115,0.15);
    color: #ffaa73;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:nth-child(7n+3) {
    background-color: rgba(254,212,102,0.15);
    color: #fed466;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:nth-child(7n+4) {
    background-color: rgba(60,220,130,0.15);
    color: #3cdc82;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:nth-child(7n+5) {
    background-color: rgba(100,220,240,0.15);
    color: #64dcf0;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:nth-child(7n+6) {
    background-color: rgba(100,185,255,0.15);
    color: #64b9ff;
    }
    #nexmoe-content .nexmoe-post .nexmoe-post-meta a:nth-child(7n+7) {
    background-color: rgba(180,180,255,0.15);
    color: #b4b4ff;
    }
  </style>


    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2022 Shuyan
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><a target="_blank" href=" "><img src="http://mms0.baidu.com/it/u=991445098,3809803602&fm=253&app=138&f=JPEG&fmt=auto&q=75?w=500&h=500" width="100px" ></a><script data-ad-client="ca-pub-2058306854838448" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: 62.5%;"> 
              <img data-src="/img/Spring整合Log4j.jpg" data-sizes="auto" alt="AOP面向切面编程" class="lazyload">
              <h1>AOP面向切面编程</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2022年05月27日</a>
</div>

      

      <p>AOP，Aspect Oriented Programming的缩写，意为<strong>面向切面编程</strong>，通过<strong>预编译方式和运行期动态代理实现程序功能的统一维护</strong>的一种技术。</p>
<h1 id="为什么要使用AOP？"><a href="#为什么要使用AOP？" class="headerlink" title="为什么要使用AOP？"></a>为什么要使用AOP？</h1><hr>
<p>  <strong>程序的最终目的就是实现业务</strong>，但是我们在进行编程的过程中经常会发现除了所谓的业务代码，还存在<strong>数量相当的公共代码，类似日志、安全验证、事物、异常处理等问题</strong>。这部分代码重要但是<strong>与我们编写程序要实现的功能没有关系</strong>，具有功能相似、重用性高、使用场景分散等特点。我们姑且称它们为<strong>共性问题</strong>。<br>  对大多数程序而言，代码都是以纵向结构将各个业务模块串联从而完成功能的。我们提到的<strong>共性问题本身不属于业务范围，但是又散落在各个业务模块间，同实现主功能的代码相互杂糅在一起</strong>，即如下图所示：  </p>
<p>![[Pasted image 20220527212606.png]]</p>
<p>程序逻辑图</p>
<p>  试想一下，如果将共性问题部分的代码融入业务代码中，<strong>一旦涉及到对某个共性问题部分的代码进行更改的时候</strong>，例如日志部分发生需求变更，<strong>我们可能需要牵涉许许多多其他模块代码</strong>。这在小规模程序中也许是可以接受的，可能只修改1、2处；但是如果牵涉的地方数量过多，特别是应用在中大型规模程序中，我们甚至会为了小小的一个功能，修改上千、上万处。这样的方式是十分糟糕的，不仅费时费力，可能还会引起一些不必要的麻烦（回归错误、结构混乱等等）。<br>  AOP的就是为了解决这类共性问题，<strong>将散落在程序中的公共部分提取出来，以切面的形式切入业务逻辑中</strong>，使程序员<strong>只专注于业务的开发，从事务提交等与业务无关的问题中解脱出来</strong>。  </p>
<p>![[Pasted image 20220527212620.png]]</p>
<p>AOP程序逻辑图</p>
<h5 id="AOP的好处"><a href="#AOP的好处" class="headerlink" title="AOP的好处"></a>AOP的好处</h5><p>  <strong>解耦</strong>：AOP将程序中的共性问题进行了剥离，毫无疑问地降低了各个业务模块和共性问题之间的耦合。<br>  <strong>重用性</strong>：共性问题散落于业务逻辑的各处，十分难维护，使用AOP进行提取后，能够将相似功能的共性问题收敛，减少重复代码，提高了代码的重用性。<br>  <strong>拓展性</strong>：对于一个程序而言，迭代的重心一定在于业务和功能上。AOP使得每当发生变更时，可以只关注业务逻辑相关的代码，而减少共性问题上带来的变化，大大降低了程序未来拓展的成本。</p>
<h1 id="Spring如何实现AOP？"><a href="#Spring如何实现AOP？" class="headerlink" title="Spring如何实现AOP？"></a>Spring如何实现AOP？</h1><hr>
<h5 id="什么是Spring-AOP？"><a href="#什么是Spring-AOP？" class="headerlink" title="什么是Spring AOP？"></a>什么是Spring AOP？</h5><p>  通过上述介绍，我们了解到AOP的重心在于<strong>定义基本结构</strong>和<strong>完成切面切入</strong>两部分，解决了它们，我们就能方便快捷的使用AOP思想进行编程了。<br>  <strong>Spring AOP就是负责完成AOP相关工作的框架，它将切面所定义的横切逻辑切入到切面所指定的连接点中</strong>。框架的目的就是将复杂的事情变得简单易用，所以其主要工作分成了如下两点：<br>  1.<strong>提供相应的数据结构来定义AOP所需基本结构</strong>，例如通知、连接点、切入点、切面等。<br>  2.<strong>封装切面切入的相关工作，提供相应接口给用户</strong>。封装的内容主要包括如何通过切面（切入点和通知）定位到特定的连接点；如何将切面中的功能代码植入到特定的连接点中等等；提供相应接口主要包括配置文件、注解等用户能够使用的工具。<br>  这里想提一下，<strong>在 Spring AOP 中，连接点（join point）总是方法的执行点， 即只有方法连接点。所以我们可以认为，在 Spring 中所有的方法都可以是连接点。</strong></p>
<h5 id="怎么使用Spring-AOP？"><a href="#怎么使用Spring-AOP？" class="headerlink" title="怎么使用Spring AOP？"></a>怎么使用Spring AOP？</h5><p>  由于Spring对AOP的封装，使得我们可以十分方便的使用，我们只需要<strong>定义切面，即定义Advice通知和Pointcut切入点</strong>。</p>
<h6 id="（1）Spring-AOP中Pointcut切入点"><a href="#（1）Spring-AOP中Pointcut切入点" class="headerlink" title="（1）Spring AOP中Pointcut切入点"></a>（1）Spring AOP中Pointcut切入点</h6><p>  使用@Pointcut(“execution()”)注解定义切入点，其中execution的格式如下所示：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">execution(modifiers-pattern? ret-<span class="hljs-keyword">type</span>-pattern declaring-<span class="hljs-keyword">type</span>-pattern? name-pattern(param-pattern) throws-pattern?) <br></code></pre></td></tr></table></figure>

<p>  其中，除ret-type-pattern和name-pattern之外，其他都是可选的，各部分具体含义如下：<br>  1.modifiers-pattern：方法的操作权限<br>  2.ret-type-pattern：返回值<br>  3.declaring-type-pattern：方法所在的包<br>  4.name-pattern：方法名<br>  5.parm-pattern：参数名<br>  6.throws-pattern：异常<br>  为了更加理解，举一个简单的execution示例，如下所示：  </p>
<p>![[Pasted image 20220527212641.png]]</p>
<p>execution示例</p>
<h6 id="（2）Spring-AOP中Advice通知"><a href="#（2）Spring-AOP中Advice通知" class="headerlink" title="（2）Spring AOP中Advice通知"></a>（2）Spring AOP中Advice通知</h6><ul>
<li>  <strong>before advice</strong>：前置通知，由@Before注解定义，表示在 join point 前被执行的advice。（虽然before advice是在 join point 前被执行，但是它并不能够阻止 join point 的执行， 除非发生了异常，即在before advice代码中， 不能人为地决定是否继续执行join point中的代码)</li>
<li>  <strong>after return advice</strong>：后置通知，由@AfterReturning注解定义，表示在一个 join point 正常返回后执行的advice。</li>
<li>  <strong>after throwing advice</strong>：异常通知，由@AfterThrowing注解定义，表示当一个 join point 抛出异常后执行的advice。</li>
<li>  <strong>after(final) advice</strong>：最终通知，由@After注解定义，表示无论一个join point是正常退出还是发生了异常，都会被执行的advice。</li>
<li>  <strong>around advice</strong>：环绕通知，由@Around注解定义，表示在join point 前和joint point退出后都执行的 advice，是最常用的advice。</li>
</ul>
<h6 id="（3）举个例子"><a href="#（3）举个例子" class="headerlink" title="（3）举个例子"></a>（3）举个例子</h6><p>  首先,我们创建一个简单的UserService，作为示例的<strong>业务模块</strong>，代码如下：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs csharp">package com.demo.aop;<br><br>import org.springframework.stereotype.Service;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by wwwwei on 17/8/14.</span><br><span class="hljs-comment"> */</span><br>@Service<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">UserService</span> &#123;<br>    <span class="hljs-comment">//创建用户</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createUser</span>(<span class="hljs-params">String userName</span>)</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;创建用户 &quot;</span> + userName);<br>    &#125;<br><br>    <span class="hljs-comment">//删除用户</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteUser</span>(<span class="hljs-params">String userName</span>)</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;删除用户 &quot;</span> + userName);<br>    &#125;<br><br>    <span class="hljs-comment">//更新用户</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateUser</span>(<span class="hljs-params">String userName</span>)</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;更新用户 &quot;</span> + userName);<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;更新用户抛出异常&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>  其次，<strong>定义切面数据结构</strong>，即通知（需要增加的功能代码片段）和切入点（切入的时间点），代码如下:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.demo.aop;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.*;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by wwwwei on 17/8/11.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserAspect</span> </span>&#123;<br>    <span class="hljs-comment">//定义切入点</span><br>    <span class="hljs-meta">@Pointcut(<span class="hljs-meta-string">&quot;execution(* com.demo.aop.*Service*.*(..))&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void pointCut() &#123;<br>    &#125;<br><br>    <span class="hljs-comment">//前置通知 @Before(value=&quot;execution(public * *(..))&quot;)</span><br>    <span class="hljs-meta">@Before(<span class="hljs-meta-string">&quot;pointCut()&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void mybefore() &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;前置通知&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//后置通知 @AfterReturning(value=&quot;execution(public * *(..))&quot;)</span><br>    <span class="hljs-meta">@AfterReturning(pointcut = <span class="hljs-meta-string">&quot;pointCut()&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void myafterReturning() &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;后置通知&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//异常通知 @AfterThrowing(value=&quot;execution(public * *(..))&quot;)</span><br>    <span class="hljs-meta">@AfterThrowing(pointcut = <span class="hljs-meta-string">&quot;pointCut()&quot;</span>, throwing = <span class="hljs-meta-string">&quot;error&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void myafterThrowing() &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;异常通知&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//环绕通知 @Around(value=&quot;execution(public * *(..))&quot;)</span><br>    <span class="hljs-meta">@Around(<span class="hljs-meta-string">&quot;pointCut()&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void myAround(ProceedingJoinPoint jp) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;环绕前通知&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            jp.proceed();<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;环绕后通知&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-comment">//最终通知 @After(value=&quot;execution(public * *(..))&quot;)</span><br>    <span class="hljs-meta">@After(<span class="hljs-meta-string">&quot;pointCut()&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void myafterLogger() &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;最终通知&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>  最后，编写测试类测试，代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.aop;<br><br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserTest</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ApplicationContext context = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<br>                <span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>        UserService userService = context.getBean(UserService.class);<br>        userService.createUser(<span class="hljs-string">&quot;测试用户&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h5 id="AOP的实现"><a href="#AOP的实现" class="headerlink" title="AOP的实现"></a>AOP的实现</h5><p> AOP的实现是基于代理机制的，根据不同实现方式主要分为两类：<br>  1.静态代理，<strong>AOP框架会在编译阶段生成AOP代理类，即在编译器和类装载期实现切入的工作</strong>，但是这种方式需要特殊的Java编译器和类装载器。AspectJ框架就是采用这种方式实现AOP。<br>  2.<strong>动态代理</strong>，<strong>AOP框架不会去修改字节码，而是在内存中临时为方法生成一个AOP对象，这个AOP对象包含了目标对象的全部方法，并且在特定的连接点（切入点）做了添加通知（advice）处理，并回调原对象的方法</strong>。<br>  与AspectJ的静态代理不同，<strong>Spring AOP使用动态代理，通过JDK Proxy和CGLIB Proxy两种方法实现代理</strong>。两种方式的选择与目标对象有关:</p>
<ul>
<li>  如果目标对象没有实现任何接口，那么Spring将使用CGLIB来实现代理。CGLIB是一个开源项目，它是一个强大的，高性能，高质量的Code生成类库，它可以在运行期扩展Java类与实现Java接口。</li>
<li>  如果目标对象实现了一个以上的接口，那么Spring将使用JDK Proxy来实现代理，因为Spring默认使用的就是JDK Proxy，并且JDK Proxy是基于接口的。这也是Spring提倡的面向接口编程。当然，你也可以强制使用CGLIB来进行代理，但是这样可能会造成性能上的下降。  </li>
</ul>
<h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><h4 id="Aspect-切面"><a href="#Aspect-切面" class="headerlink" title="Aspect(切面)"></a>Aspect(切面)</h4><p><code>aspect</code> 由 <code>pointcount</code> 和 <code>advice</code> 组成, 它既包含了横切逻辑的定义, 也包括了连接点的定义. Spring AOP就是负责实施切面的框架, 它将切面所定义的横切逻辑织入到切面所指定的连接点中.<br>AOP的工作重心在于如何将增强织入目标对象的连接点上, 这里包含两个工作:</p>
<ol>
<li> 如何通过 pointcut 和 advice 定位到特定的 joinpoint 上</li>
<li> 如何在 advice 中编写切面代码.</li>
</ol>
<p><strong>可以简单地认为, 使用 @Aspect 注解的类就是切面.</strong></p>
<hr>
<h4 id="advice-增强"><a href="#advice-增强" class="headerlink" title="advice(增强)"></a>advice(增强)</h4><p>由 aspect 添加到特定的 join point(即满足 point cut 规则的 join point) 的一段代码.<br>许多 AOP框架, 包括 Spring AOP, 会将 advice 模拟为一个拦截器(interceptor), 并且在 join point 上维护多个 advice, 进行层层拦截.<br>例如 HTTP 鉴权的实现, 我们可以为每个使用 RequestMapping 标注的方法织入 advice, 当 HTTP 请求到来时, 首先进入到 advice 代码中, 在这里我们可以分析这个 HTTP 请求是否有相应的权限, 如果有, 则执行 Controller, 如果没有, 则抛出异常. 这里的 advice 就扮演着鉴权拦截器的角色了.</p>
<hr>
<h4 id="连接点-join-point"><a href="#连接点-join-point" class="headerlink" title="连接点(join point)"></a>连接点(join point)</h4><blockquote>
<p>a point during the execution of a program, such as the execution of a method or the handling of an exception. In Spring AOP, a join point always represents a method execution.</p>
</blockquote>
<p>程序运行中的一些时间点, 例如一个方法的执行, 或者是一个异常的处理.<br>在 Spring AOP 中, join point 总是方法的执行点, 即只有方法连接点.</p>
<hr>
<h4 id="切点-point-cut"><a href="#切点-point-cut" class="headerlink" title="切点(point cut)"></a>切点(point cut)</h4><p>匹配 join point 的谓词(a predicate that matches join points).<br>Advice 是和特定的 point cut 关联的, 并且在 point cut 相匹配的 join point 中执行.<br>在 Spring 中, 所有的方法都可以认为是 joinpoint, 但是我们并不希望在所有的方法上都添加 Advice, 而 pointcut 的作用就是提供一组规则(使用 AspectJ pointcut expression language 来描述) 来匹配joinpoint, 给满足规则的 joinpoint 添加 Advice.</p>
<hr>
<h4 id="关于join-point-和-point-cut-的区别"><a href="#关于join-point-和-point-cut-的区别" class="headerlink" title="关于join point 和 point cut 的区别"></a>关于join point 和 point cut 的区别</h4><p>在 Spring AOP 中, 所有的方法执行都是 join point. 而 point cut 是一个描述信息, 它修饰的是 join point, 通过 point cut, 我们就可以确定哪些 join point 可以被织入 Advice. 因此 join point 和 point cut 本质上就是两个不同纬度上的东西.<br><em>advice 是在 join point 上执行的, 而 point cut 规定了哪些 join point 可以执行哪些 advice</em></p>
<hr>
<h4 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h4><p>为一个类型添加额外的方法或字段. Spring AOP 允许我们为 <code>目标对象</code> 引入新的接口(和对应的实现). 例如我们可以使用 introduction 来为一个 bean 实现 IsModified 接口, 并以此来简化 caching 的实现.</p>
<hr>
<h4 id="目标对象-Target"><a href="#目标对象-Target" class="headerlink" title="目标对象(Target)"></a>目标对象(Target)</h4><p>织入 advice 的目标对象. 目标对象也被称为 <code>advised object</code>.<br>因为 Spring AOP 使用运行时代理的方式来实现 aspect, 因此 adviced object 总是一个代理对象(proxied object)<br><strong>注意</strong>, adviced object 指的不是原来的类, 而是织入 advice 后所产生的代理类.</p>
<hr>
<h4 id="AOP-proxy"><a href="#AOP-proxy" class="headerlink" title="AOP proxy"></a>AOP proxy</h4><p>一个类被 AOP 织入 advice, 就会产生一个结果类, 它是融合了原类和增强逻辑的代理类.<br>在 Spring AOP 中, 一个 AOP 代理是一个 JDK 动态代理对象或 CGLIB 代理对象.</p>
<hr>
<h4 id="织入-Weaving"><a href="#织入-Weaving" class="headerlink" title="织入(Weaving)"></a>织入(Weaving)</h4><p>将 aspect 和其他对象连接起来, 并创建 adviced object 的过程.<br>根据不同的实现技术, AOP织入有三种方式:</p>
<ul>
<li>  编译器织入, 这要求有特殊的Java编译器.</li>
<li>  类装载期织入, 这需要有特殊的类装载器.</li>
<li>动态代理织入, 在运行期为目标类添加增强(Advice)生成子类的方式.<br>  Spring 采用动态代理织入, 而AspectJ采用编译器织入和类装载期织入.</li>
</ul>
<hr>
<h3 id="advice-的类型"><a href="#advice-的类型" class="headerlink" title="advice 的类型"></a>advice 的类型</h3><ul>
<li>  before advice, 在 join point 前被执行的 advice. 虽然 before advice 是在 join point 前被执行, 但是它并不能够阻止 join point 的执行, 除非发生了异常(即我们在 before advice 代码中, 不能人为地决定是否继续执行 join point 中的代码)</li>
<li>  after return advice, 在一个 join point 正常返回后执行的 advice</li>
<li>  after throwing advice, 当一个 join point 抛出异常后执行的 advice</li>
<li>  after(final) advice, 无论一个 join point 是正常退出还是发生了异常, 都会被执行的 advice.</li>
<li>  around advice, 在 join point 前和 joint point 退出后都执行的 advice. 这个是最常用的 advice.</li>
</ul>
<hr>
<h3 id="关于-AOP-Proxy"><a href="#关于-AOP-Proxy" class="headerlink" title="关于 AOP Proxy"></a>关于 AOP Proxy</h3><p>Spring AOP 默认使用标准的 JDK 动态代理(dynamic proxy)技术来实现 AOP 代理, 通过它, 我们可以为任意的接口实现代理.<br><code>如果需要为一个类实现代理, 那么可以使用 CGLIB 代理.</code> 当一个业务逻辑对象没有实现接口时, 那么Spring AOP 就默认使用 CGLIB 来作为 AOP 代理了. 即如果我们需要为一个方法织入 advice, 但是这个方法不是一个接口所提供的方法, 则此时 Spring AOP 会使用 CGLIB 来实现动态代理. 鉴于此, Spring AOP 建议基于接口编程, 对接口进行 AOP 而不是类.</p>
<h2 id="彻底理解-aspect-join-point-point-cut-advice"><a href="#彻底理解-aspect-join-point-point-cut-advice" class="headerlink" title="彻底理解 aspect, join point, point cut, advice"></a>彻底理解 aspect, join point, point cut, advice</h2><p>下面以一个简单的例子来比喻一下 AOP 中 aspect, jointpoint, pointcut 与 advice 之间的关系.</p>
<p>让我们来假设一下, 从前有一个叫爪哇的小县城, 在一个月黑风高的晚上, 这个县城中发生了命案. 作案的凶手十分狡猾, 现场没有留下什么有价值的线索. 不过万幸的是, 刚从隔壁回来的老王恰好在这时候无意中发现了凶手行凶的过程, 但是由于天色已晚, 加上凶手蒙着面, 老王并没有看清凶手的面目, 只知道凶手是个男性, 身高约七尺五寸. 爪哇县的县令根据老王的描述, 对守门的士兵下命令说: 凡是发现有身高七尺五寸的男性, 都要抓过来审问. 士兵当然不敢违背县令的命令, 只好把进出城的所有符合条件的人都抓了起来.</p>
<p>来让我们看一下上面的一个小故事和 AOP 到底有什么对应关系.<br>首先我们知道, 在 Spring AOP 中 join point 指代的是所有方法的执行点, 而 point cut 是一个描述信息, 它修饰的是 join point, 通过 point cut, 我们就可以确定哪些 join point 可以被织入 Advice. 对应到我们在上面举的例子, 我们可以做一个简单的类比, join point 就相当于 <strong>爪哇的小县城里的百姓</strong>, point cut 就相当于 <strong>老王所做的指控, 即凶手是个男性, 身高约七尺五寸</strong>, 而 advice 则是施加在符合老王所描述的嫌疑人的动作: <strong>抓过来审问</strong>.<br>为什么可以这样类比呢?</p>
<ul>
<li>  join point –&gt; 爪哇的小县城里的百姓: 因为根据定义, join point 是所有可能被织入 advice 的候选的点, 在 Spring AOP中, 则可以认为所有方法执行点都是 join point. 而在我们上面的例子中, 命案发生在小县城中, 按理说在此县城中的所有人都有可能是嫌疑人.</li>
<li>  point cut –&gt; 男性, 身高约七尺五寸: 我们知道, 所有的方法(joint point) 都可以织入 advice, 但是我们并不希望在所有方法上都织入 advice, 而 pointcut 的作用就是提供一组规则来匹配joinpoint, 给满足规则的 joinpoint 添加 advice. 同理, 对于县令来说, 他再昏庸, 也知道不能把县城中的所有百姓都抓起来审问, 而是根据<code>凶手是个男性, 身高约七尺五寸</code>, 把符合条件的人抓起来. 在这里 <code>凶手是个男性, 身高约七尺五寸</code> 就是一个修饰谓语, 它限定了凶手的范围, 满足此修饰规则的百姓都是嫌疑人, 都需要抓起来审问.</li>
<li>  advice –&gt; 抓过来审问, advice 是一个动作, 即一段 Java 代码, 这段 Java 代码是作用于 point cut 所限定的那些 join point 上的. 同理, 对比到我们的例子中, <code>抓过来审问</code> 这个动作就是对作用于那些满足 <code>男性, 身高约七尺五寸</code> 的<code>爪哇的小县城里的百姓</code>.</li>
<li>  aspect: aspect 是 point cut 与 advice 的组合, 因此在这里我们就可以类比: <strong>“根据老王的线索, 凡是发现有身高七尺五寸的男性, 都要抓过来审问”</strong> 这一整个动作可以被认为是一个 aspect.</li>
</ul>
<hr>
<p>或则我们也可以从语法的角度来简单类比一下. 我们在学英语时, 经常会接触什么 <code>定语</code>, <code>被动句</code> 之类的概念, 那么可以做一个不严谨的类比, 即 <code>joinpoint</code> 可以认为是一个 <code>宾语</code>, 而 <code>pointcut</code> 则可以类比为修饰 <code>joinpoint</code> 的定语, 那么整个 <code>aspect</code> 就可以描述为: <code>满足 pointcut 规则的 joinpoint 会被添加相应的 advice 操作.</code></p>
<hr>
<h2 id="AspectJ-支持"><a href="#AspectJ-支持" class="headerlink" title="@AspectJ 支持"></a>@AspectJ 支持</h2><p><strong>@AspectJ</strong> 是一种使用 Java 注解来实现 AOP 的编码风格.<br>@AspectJ 风格的 AOP 是 AspectJ Project 在 AspectJ 5 中引入的, 并且 Spring 也支持@AspectJ 的 AOP 风格.</p>
<h3 id="使能-AspectJ-支持"><a href="#使能-AspectJ-支持" class="headerlink" title="使能 @AspectJ 支持"></a>使能 @AspectJ 支持</h3><p>@AspectJ 可以以 XML 的方式或以注解的方式来使能, 并且不论以哪种方式使能@ASpectJ, 我们都必须保证 aspectjweaver.jar 在 classpath 中.</p>
<h4 id="使用-Java-Configuration-方式使能-AspectJ"><a href="#使用-Java-Configuration-方式使能-AspectJ" class="headerlink" title="使用 Java Configuration 方式使能@AspectJ"></a>使用 Java Configuration 方式使能@AspectJ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableAspectJAutoProxy</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppConfig</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="使用-XML-方式使能-AspectJ"><a href="#使用-XML-方式使能-AspectJ" class="headerlink" title="使用 XML 方式使能@AspectJ"></a>使用 XML 方式使能@AspectJ</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span>/&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="定义-aspect-切面"><a href="#定义-aspect-切面" class="headerlink" title="定义 aspect(切面)"></a>定义 aspect(切面)</h3><p>当使用注解 <strong>@Aspect</strong> 标注一个 Bean 后, 那么 Spring 框架会自动收集这些 Bean, 并添加到 Spring AOP 中, 例如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyTest</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意, 仅仅使用@Aspect 注解, 并不能将一个 Java 对象转换为 Bean, 因此我们还需要使用类似 @Component 之类的注解.<br>注意, 如果一个 类被@Aspect 标注, 则这个类就不能是其他 aspect 的 <strong>advised object</strong> 了, 因为使用 @Aspect 后, 这个类就会被排除在 auto-proxying 机制之外.</p>
<hr>
<h3 id="声明-pointcut"><a href="#声明-pointcut" class="headerlink" title="声明 pointcut"></a>声明 pointcut</h3><p>一个 pointcut 的声明由两部分组成:</p>
<ul>
<li>  一个方法签名, 包括方法名和相关参数</li>
<li>  一个 pointcut 表达式, 用来指定哪些方法执行是我们感兴趣的(即因此可以织入 advice).</li>
</ul>
<p>在@AspectJ 风格的 AOP 中, 我们使用一个方法来描述 pointcut, 即:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;execution(* com.xys.service.UserService.(..))&quot;)</span> <span class="hljs-comment">// 切点表达式</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dataAccessOperation</span><span class="hljs-params">()</span> </span>&#123;&#125; <span class="hljs-comment">// 切点前面</span><br></code></pre></td></tr></table></figure>

<p>这个方法必须无返回值.<br>这个方法本身就是<code>pointcut signature, pointcut</code>表达式使用@Pointcut 注解指定.<br>上面我们简单地定义了一个 pointcut, 这个 pointcut 所描述的是: 匹配所有在包<code>com.xys.service.UserService</code>下的所有方法的执行.</p>
<hr>
<h4 id="切点标志符-designator"><a href="#切点标志符-designator" class="headerlink" title="切点标志符(designator)"></a>切点标志符(designator)</h4><p>AspectJ5 的切点表达式由标志符(designator)和操作参数组成. 如 “execution( _greetTo(..))” 的切点表达式, execution 就是 标志符, 而圆括号里的_ greetTo(..) 就是操作参数</p>
<hr>
<h5 id="execution"><a href="#execution" class="headerlink" title="execution"></a>execution</h5><p>匹配 join point 的执行, 例如 “execution(* hello(..))” 表示匹配所有目标类中的 hello() 方法. 这个是最基本的 pointcut 标志符.</p>
<hr>
<h5 id="within"><a href="#within" class="headerlink" title="within"></a>within</h5><p>匹配特定包下的所有 join point, 例如 <code>within(com.xys.*)</code> 表示 com.xys 包中的所有连接点, 即包中的所有类的所有方法. 而 <code>within(com.xys.service.*Service)</code> 表示在 com.xys.service 包中所有以 Service 结尾的类的所有的连接点.</p>
<hr>
<h5 id="this-与-target"><a href="#this-与-target" class="headerlink" title="this 与 target"></a>this 与 target</h5><p>this 的作用是匹配一个 bean, 这个 bean(Spring AOP proxy) 是一个给定类型的实例(instance of). 而 target 匹配的是一个目标对象(target object, 即需要织入 advice 的原始的类), 此对象是一个给定类型的实例(instance of).</p>
<hr>
<h5 id="bean"><a href="#bean" class="headerlink" title="bean"></a>bean</h5><p>匹配 bean 名字为指定值的 bean 下的所有方法, 例如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">bean(Service) <span class="hljs-comment">// 匹配名字后缀为 Service 的 bean 下的所有方法</span><br><br>bean(myService) <span class="hljs-comment">// 匹配名字为 myService 的 bean 下的所有方法</span><br></code></pre></td></tr></table></figure>

<hr>
<h5 id="args"><a href="#args" class="headerlink" title="args"></a>args</h5><p>匹配参数满足要求的的方法.<br>例如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;within(com.xys.demo2.*)&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pointcut2</span><span class="hljs-params">()</span> </span>&#123;<br>&#125;<br><br><span class="hljs-meta">@Before(value = &quot;pointcut2()  &amp;&amp;  args(name)&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">(String name)</span> </span>&#123;<br>    logger.info(<span class="hljs-string">&quot;---page: &#123;&#125;---&quot;</span>, name);<br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NormalService</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(getClass());<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">someMethod</span><span class="hljs-params">()</span> </span>&#123;<br>        logger.info(<span class="hljs-string">&quot;---NormalService: someMethod invoked---&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">test</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        logger.info(<span class="hljs-string">&quot;---NormalService: test invoked---&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;服务一切正常&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>当 NormalService.test 执行时, 则 advice <code>doSomething</code> 就会执行, test 方法的参数 name 就会传递到 <code>doSomething</code> 中.</p>
<p>常用例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 匹配只有一个参数 name 的方法</span><br><span class="hljs-meta">@Before(value = &quot;aspectMethod()  &amp;&amp;  args(name)&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">(String name)</span> </span>&#123;<br>&#125;<br><br><span class="hljs-comment">// 匹配第一个参数为 name 的方法</span><br><span class="hljs-meta">@Before(value = &quot;aspectMethod()  &amp;&amp;  args(name, ..)&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">(String name)</span> </span>&#123;<br>&#125;<br><br><span class="hljs-comment">// 匹配第二个参数为 name 的方法</span><br>Before(value = <span class="hljs-string">&quot;aspectMethod()  &amp;&amp;  args(*, name, ..)&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">(String name)</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h5 id="annotation"><a href="#annotation" class="headerlink" title="@annotation"></a>@annotation</h5><p>匹配由指定注解所标注的方法, 例如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;@annotation(com.xys.demo1.AuthChecker)&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pointcut</span><span class="hljs-params">()</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>则匹配由注解 <code>AuthChecker</code> 所标注的方法.</p>
<h4 id="常见的切点表达式"><a href="#常见的切点表达式" class="headerlink" title="常见的切点表达式"></a>常见的切点表达式</h4><h5 id="匹配方法签名"><a href="#匹配方法签名" class="headerlink" title="匹配方法签名"></a>匹配方法签名</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 匹配指定包中的所有的方法</span><br>execution(* com.shuyan.service.*(..))<br><br><span class="hljs-comment">// 匹配当前包中的指定类的所有方法</span><br>execution(* UserService.*(..))<br><br><span class="hljs-comment">// 匹配指定包中的所有 public 方法</span><br>execution(<span class="hljs-keyword">public</span> * com.shuyan.service.*(..))<br><br><span class="hljs-comment">// 匹配指定包中的所有 public 方法, 并且返回值是 int 类型的方法</span><br>execution(<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> com.shuyan.service.*(..))<br><br><span class="hljs-comment">// 匹配指定包中的所有 public 方法, 并且第一个参数是 String, 返回值是 int 类型的方法</span><br>execution(<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> com.shuyan.service.*(String name, ..))<br></code></pre></td></tr></table></figure>

<h5 id="匹配类型签名"><a href="#匹配类型签名" class="headerlink" title="匹配类型签名"></a>匹配类型签名</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 匹配指定包中的所有的方法, 但不包括子包</span><br>within(com.shuyan.service.*)<br><br><span class="hljs-comment">// 匹配指定包中的所有的方法, 包括子包</span><br>within(com.shuyan.service..*)<br><br><span class="hljs-comment">// 匹配当前包中的指定类中的方法</span><br>within(UserService)<br><br><span class="hljs-comment">// 匹配一个接口的所有实现类中的实现的方法</span><br>within(UserDao+)<br></code></pre></td></tr></table></figure>

<h5 id="匹配-Bean-名字"><a href="#匹配-Bean-名字" class="headerlink" title="匹配 Bean 名字"></a>匹配 Bean 名字</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 匹配以指定名字结尾的 Bean 中的所有方法</span><br>bean(*Service)<br></code></pre></td></tr></table></figure>

<h5 id="切点表达式组合"><a href="#切点表达式组合" class="headerlink" title="切点表达式组合"></a>切点表达式组合</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 匹配以 Service 或 ServiceImpl 结尾的 bean</span><br>bean(*Service || *ServiceImpl)<br><br><span class="hljs-comment">// 匹配名字以 Service 结尾, 并且在包 com.xys.service 中的 bean</span><br>bean(*Service) &amp;&amp; within(com.shuyan.service.*)<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="声明-advice"><a href="#声明-advice" class="headerlink" title="声明 advice"></a>声明 advice</h3><p>advice 是和一个 pointcut 表达式关联在一起的, 并且会在匹配的 join point 的方法执行的前/后/周围 运行. <code>pointcut 表达式可以是简单的一个 pointcut 名字的引用, 或者是完整的 pointcut 表达式</code>.<br>下面我们以几个简单的 advice 为例子, 来看一下一个 advice 是如何声明的.</p>
<hr>
<h4 id="Before-advice"><a href="#Before-advice" class="headerlink" title="Before advice"></a>Before advice</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeforeAspectTest</span> </span>&#123;<br>    <span class="hljs-comment">// 定义一个 Pointcut, 使用 切点表达式函数 来描述对哪些 Join point 使用 advise.</span><br>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.shuyan.service.UserService.*(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dataAccessOperation</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdviseDefine</span> </span>&#123;<br>    <span class="hljs-comment">// 定义 advise</span><br>    <span class="hljs-meta">@Before(&quot;com.shuyan.aspect.PointcutDefine.dataAccessOperation()&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doBeforeAccessCheck</span><span class="hljs-params">(JoinPoint joinPoint)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;*****Before advise, method: &quot;</span> + joinPoint.getSignature().toShortString() + <span class="hljs-string">&quot; *****&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里, <strong>@Before</strong> 引用了一个 pointcut, 即 “com.xys.aspect.PointcutDefine.dataAccessOperation()” 是一个 pointcut 的名字.<br>如果我们在 advice 在内置 pointcut, 则可以:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdviseDefine</span> </span>&#123;<br>    <span class="hljs-comment">// 将 pointcut 和 advice 同时定义</span><br>    <span class="hljs-meta">@Before(&quot;within(com.shuyan.service..*)&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAccessCheck</span><span class="hljs-params">(JoinPoint joinPoint)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;*****doAccessCheck, Before advise, method: &quot;</span> + joinPoint.getSignature().toShortString() + <span class="hljs-string">&quot; *****&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h4 id="around-advice"><a href="#around-advice" class="headerlink" title="around advice"></a>around advice</h4><p>around advice 比较特别, 它可以在一个方法的之前之前和之后添加不同的操作, 并且甚至可以决定何时, 如何, 是否调用匹配到的方法.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdviseDefine</span> </span>&#123;<br>    <span class="hljs-comment">// 定义 advise</span><br>    <span class="hljs-meta">@Around(&quot;com.shuyan.aspect.PointcutDefine.dataAccessOperation()&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">doAroundAccessCheck</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        StopWatch stopWatch = <span class="hljs-keyword">new</span> StopWatch();<br>        stopWatch.start();<br>        <span class="hljs-comment">// 开始</span><br>        Object retVal = pjp.proceed();<br>        stopWatch.stop();<br>        <span class="hljs-comment">// 结束</span><br>        System.out.println(<span class="hljs-string">&quot;invoke method: &quot;</span> + pjp.getSignature().getName() + <span class="hljs-string">&quot;, elapsed time: &quot;</span> + stopWatch.getTotalTimeMillis());<br>        <span class="hljs-keyword">return</span> retVal;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>around advice 和前面的 before advice 差不多, 只是我们把注解 <strong>@Before</strong> 改为了 <strong>@Around</strong> 了.</p>

  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>Author：</strong>Shuyan<br>
        <strong>Link：</strong><a href="http://example.com/2022/05/27/JAVA/Spring%E6%A1%86%E6%9E%B6/Spring/AOP/" title="http:&#x2F;&#x2F;example.com&#x2F;2022&#x2F;05&#x2F;27&#x2F;JAVA&#x2F;Spring%E6%A1%86%E6%9E%B6&#x2F;Spring&#x2F;AOP&#x2F;" target="_blank" rel="noopener">http:&#x2F;&#x2F;example.com&#x2F;2022&#x2F;05&#x2F;27&#x2F;JAVA&#x2F;Spring%E6%A1%86%E6%9E%B6&#x2F;Spring&#x2F;AOP&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/JAVA/">JAVA</a><a class="nexmoefont icon-appstore-fill -link" href="/categories/JAVA/%E2%80%9CSpring%E6%A1%86%E6%9E%B6%E2%80%9D/">“Spring框架”</a><a class="nexmoefont icon-appstore-fill -link" href="/categories/JAVA/%E2%80%9CSpring%E6%A1%86%E6%9E%B6%E2%80%9D/Spring/">Spring</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Spring/" rel="tag">Spring</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '80b2453b6d5f37ad6225',
        clientSecret: '43e99fa852795c9a7b3eb924b2558c64b84bbdeb',
        id: window.location.pathname,
        repo: 'nexmoe.github.io',
        owner: 'nexmoe',
        admin: 'nexmoe'
    })
    gitalk.render('gitalk')
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8AOP%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">为什么要使用AOP？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AOP%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">1.0.0.0.1.</span> <span class="toc-text">AOP的好处</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0AOP%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">Spring如何实现AOP？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSpring-AOP%EF%BC%9F"><span class="toc-number">2.0.0.0.1.</span> <span class="toc-text">什么是Spring AOP？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8Spring-AOP%EF%BC%9F"><span class="toc-number">2.0.0.0.2.</span> <span class="toc-text">怎么使用Spring AOP？</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%EF%BC%881%EF%BC%89Spring-AOP%E4%B8%ADPointcut%E5%88%87%E5%85%A5%E7%82%B9"><span class="toc-number">2.0.0.0.2.1.</span> <span class="toc-text">（1）Spring AOP中Pointcut切入点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%EF%BC%882%EF%BC%89Spring-AOP%E4%B8%ADAdvice%E9%80%9A%E7%9F%A5"><span class="toc-number">2.0.0.0.2.2.</span> <span class="toc-text">（2）Spring AOP中Advice通知</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E4%B8%BE%E4%B8%AA%E4%BE%8B%E5%AD%90"><span class="toc-number">2.0.0.0.2.3.</span> <span class="toc-text">（3）举个例子</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AOP%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.0.0.0.3.</span> <span class="toc-text">AOP的实现</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AF%E8%AF%AD"><span class="toc-number">3.</span> <span class="toc-text">术语</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Aspect-%E5%88%87%E9%9D%A2"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">Aspect(切面)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#advice-%E5%A2%9E%E5%BC%BA"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">advice(增强)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%82%B9-join-point"><span class="toc-number">3.0.0.3.</span> <span class="toc-text">连接点(join point)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E7%82%B9-point-cut"><span class="toc-number">3.0.0.4.</span> <span class="toc-text">切点(point cut)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ejoin-point-%E5%92%8C-point-cut-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.0.0.5.</span> <span class="toc-text">关于join point 和 point cut 的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#introduction"><span class="toc-number">3.0.0.6.</span> <span class="toc-text">introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E5%AF%B9%E8%B1%A1-Target"><span class="toc-number">3.0.0.7.</span> <span class="toc-text">目标对象(Target)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP-proxy"><span class="toc-number">3.0.0.8.</span> <span class="toc-text">AOP proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%87%E5%85%A5-Weaving"><span class="toc-number">3.0.0.9.</span> <span class="toc-text">织入(Weaving)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#advice-%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.0.1.</span> <span class="toc-text">advice 的类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-AOP-Proxy"><span class="toc-number">3.0.2.</span> <span class="toc-text">关于 AOP Proxy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3-aspect-join-point-point-cut-advice"><span class="toc-number">3.1.</span> <span class="toc-text">彻底理解 aspect, join point, point cut, advice</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AspectJ-%E6%94%AF%E6%8C%81"><span class="toc-number">3.2.</span> <span class="toc-text">@AspectJ 支持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E8%83%BD-AspectJ-%E6%94%AF%E6%8C%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">使能 @AspectJ 支持</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Java-Configuration-%E6%96%B9%E5%BC%8F%E4%BD%BF%E8%83%BD-AspectJ"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">使用 Java Configuration 方式使能@AspectJ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-XML-%E6%96%B9%E5%BC%8F%E4%BD%BF%E8%83%BD-AspectJ"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">使用 XML 方式使能@AspectJ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-aspect-%E5%88%87%E9%9D%A2"><span class="toc-number">3.2.2.</span> <span class="toc-text">定义 aspect(切面)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-pointcut"><span class="toc-number">3.2.3.</span> <span class="toc-text">声明 pointcut</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E7%82%B9%E6%A0%87%E5%BF%97%E7%AC%A6-designator"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">切点标志符(designator)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#execution"><span class="toc-number">3.2.3.1.1.</span> <span class="toc-text">execution</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#within"><span class="toc-number">3.2.3.1.2.</span> <span class="toc-text">within</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#this-%E4%B8%8E-target"><span class="toc-number">3.2.3.1.3.</span> <span class="toc-text">this 与 target</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bean"><span class="toc-number">3.2.3.1.4.</span> <span class="toc-text">bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#args"><span class="toc-number">3.2.3.1.5.</span> <span class="toc-text">args</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#annotation"><span class="toc-number">3.2.3.1.6.</span> <span class="toc-text">@annotation</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%88%87%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">常见的切点表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D"><span class="toc-number">3.2.3.2.1.</span> <span class="toc-text">匹配方法签名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E7%B1%BB%E5%9E%8B%E7%AD%BE%E5%90%8D"><span class="toc-number">3.2.3.2.2.</span> <span class="toc-text">匹配类型签名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D-Bean-%E5%90%8D%E5%AD%97"><span class="toc-number">3.2.3.2.3.</span> <span class="toc-text">匹配 Bean 名字</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%87%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%84%E5%90%88"><span class="toc-number">3.2.3.2.4.</span> <span class="toc-text">切点表达式组合</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E-advice"><span class="toc-number">3.2.4.</span> <span class="toc-text">声明 advice</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Before-advice"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">Before advice</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#around-advice"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">around advice</span></a></li></ol></li></ol></li></ol></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
     
    <div id="nexmoe-search-space">
        <div class="search-container">
            <div class="search-header">
                <div class="search-input-container">
                    <input class="search-input" type="text" placeholder="Search" oninput="sinput();">
                </div>
                <a class="search-close" onclick="sclose();">×</a>
            </div>
            <div class="search-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1657720477507"></script>



<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





    <!-- baidu Analytics -->
<script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?0a7e154da92f76d05c83b48cbab331da#&lt;ID&gt;';
    var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>

</html>
